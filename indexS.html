<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>一如地號搜尋</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: #f5f5f5; min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Header样式 */
        .header { 
            background: white; 
            padding: 20px 40px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            position: relative;
        }
        .logo-title { display: flex; align-items: center; gap: 15px; }
        .logo { width: 50px; height: auto; }
        .header h1 { font-size: 1.8rem; color: #DC2626; }
        
        /* 导航栏 */
        .header-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #user-info-display {
            display: none;
            align-items: center;
            gap: 15px;
        }
        
        #username-display {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }

        #logout-button {
            padding: 8px 20px;
            background: #f0f0f0;
            color: #DC2626;
            border: 2px solid #f0f0f0;
            border-radius: 6px;
            transition: all 0.3s;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
        }
        
        #logout-button:hover {
            border: 2px solid #DC2626;
            color: #DC2626;
            background: white;
        }

        .nav-link {
            padding: 8px 20px;
            color: #666;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s;
            font-weight: 500;
            background: transparent;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .nav-link:hover {
            color: #DC2626;
            background: #f0f0f0;
        }

        .nav-link.active {
            background: #DC2626;
            color: white;
        }
        
        .back-link { 
            padding: 10px 25px; 
            background: white; 
            color: #DC2626; 
            text-decoration: none; 
            border: 2px solid #DC2626; 
            border-radius: 6px; 
            font-weight: 600; 
            transition: all 0.3s; 
        }
        .back-link:hover { background: #DC2626; color: white; }
        
        /* 搜索区域 */
        .search-container { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px 20px; max-width: 800px; margin: 0 auto; width: 100%; }
        .search-logo { margin-bottom: 40px; text-align: center; }
        .search-logo img { width: 200px; height: auto; margin-bottom: 20px; }
        .search-logo h2 { font-size: 2rem; color: #333; margin-bottom: 10px; }
        .search-logo p { font-size: 1.1rem; color: #666; }
        .search-box { width: 100%; max-width: 600px; }
        .search-input { width: 100%; padding: 18px 25px; font-size: 1.2rem; border: 2px solid #ddd; border-radius: 50px; outline: none; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .search-input:focus { border-color: #DC2626; box-shadow: 0 4px 16px rgba(220, 38, 38, 0.2); }
        .search-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 30px; }
        .search-btn { padding: 12px 30px; background: #DC2626; color: white; border: none; border-radius: 6px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .search-btn:hover { background: #b91c1c; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3); }
        .clear-btn { padding: 12px 30px; background: white; color: #666; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .clear-btn:hover { border-color: #DC2626; color: #DC2626; }
        .search-tips { margin-top: 40px; text-align: center; color: #666; }
        .search-tips p { margin: 8px 0; font-size: 0.95rem; }
        .search-tips strong { color: #DC2626; }
        
        /* 结果区域 */
        .results-section { display: none; height: calc(100vh - 100px); overflow: hidden; }
        .split-container { display: flex; height: 100%; }
        .left-panel { width: 35%; background: #f8f9fa; border-right: 2px solid #e5e7eb; display: flex; flex-direction: column; overflow: hidden; }
        .results-header { background: white; padding: 20px 25px; border-bottom: 2px solid #e5e7eb; flex-shrink: 0; }
        .results-count { font-size: 1.1rem; color: #666; margin-bottom: 15px; }
        .results-count strong { color: #DC2626; font-size: 1.3rem; }
        .results-list { flex: 1; overflow-y: auto; padding: 20px; }
        .result-item { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .result-item:hover { border-color: #DC2626; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.15); }
        .result-item.active { border-color: #DC2626; background: #fff5f5; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2); }
        .result-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .result-land-number { font-size: 1.3rem; font-weight: 700; color: #DC2626; }
        .result-badges { display: flex; gap: 5px; }
        .result-badge { padding: 3px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; color: white; }
        .badge-type { background: #DC2626; }
        .badge-agent { background: #2563eb; }
        .result-item-body { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .result-detail { display: flex; flex-direction: column; gap: 2px; }
        .result-label { font-size: 0.75rem; color: #999; }
        .result-value { font-size: 0.9rem; font-weight: 600; color: #333; }
        .result-price { grid-column: 1 / -1; text-align: center; margin-top: 8px; padding-top: 12px; border-top: 1px solid #e5e7eb; }
        .result-price-amount { font-size: 1.5rem; font-weight: 700; color: #DC2626; }
        .no-price-badge { display: inline-block; padding: 6px 16px; background: #f59e0b; color: white; border-radius: 6px; font-size: 0.9rem; font-weight: 600; }
        .right-panel { width: 65%; background: white; overflow-y: auto; }
        .detail-container { max-width: 900px; margin: 0 auto; padding: 40px; }
        .detail-header { margin-bottom: 30px; }
        .detail-title { font-size: 2rem; font-weight: 700; color: #DC2626; margin-bottom: 15px; }
        .detail-location { display: flex; align-items: center; gap: 8px; font-size: 1.1rem; color: #666; margin-bottom: 20px; }
        .detail-badges { display: flex; gap: 10px; flex-wrap: wrap; }
        .detail-badge { padding: 6px 15px; border-radius: 6px; font-size: 0.9rem; font-weight: 600; color: white; }
        .detail-map { width: 100%; height: 400px; border-radius: 12px; overflow: hidden; margin-bottom: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .detail-info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; padding: 30px; background: #f8f9fa; border-radius: 12px; }
        .info-item { text-align: center; }
        .info-label { font-size: 0.9rem; color: #999; margin-bottom: 8px; }
        .info-value { font-size: 1.3rem; font-weight: 700; color: #333; }
        .detail-price-section { background: linear-gradient(135deg, #DC2626 0%, #b91c1c 100%); padding: 40px; border-radius: 12px; text-align: center; margin-bottom: 30px; color: white; }
        .detail-price-label { font-size: 1rem; opacity: 0.9; margin-bottom: 10px; }
        .detail-price-amount { font-size: 3rem; font-weight: 700; }
        .detail-price-unit { font-size: 1.2rem; margin-left: 10px; }
        .detail-price-per-ping { font-size: 1.1rem; opacity: 0.9; margin-top: 10px; }
        .detail-actions { display: flex; gap: 15px; justify-content: center; }
        .action-btn { padding: 15px 40px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: #DC2626; color: white; }
        .btn-primary:hover { background: #b91c1c; transform: translateY(-2px); box-shadow: 0 6px 16px rgba(220, 38, 38, 0.3); }
        .btn-secondary { background: #2563eb; color: white; }
        .btn-secondary:hover { background: #1d4ed8; transform: translateY(-2px); box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3); }
        .btn-success { background: #059669; color: white; }
        .btn-success:hover { background: #047857; transform: translateY(-2px); box-shadow: 0 6px 16px rgba(5, 150, 105, 0.3); }
        .no-results { text-align: center; padding: 60px 20px; }
        .no-results h3 { font-size: 1.5rem; color: #666; margin-bottom: 15px; }
        .empty-state { text-align: center; padding: 100px 40px; color: #aaa; }
        .empty-state h3 { font-size: 1.8rem; margin-bottom: 15px; }
        .empty-state p { font-size: 1.1rem; }

        /* 登入模態框 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: white;
            padding: 30px 40px;
            border-radius: 12px;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            position: relative;
            transform: scale(0.95);
            transition: transform 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .close-modal-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2rem;
            color: #aaa;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s;
        }

        .close-modal-btn:hover {
            color: #333;
        }

        .modal-content h2 {
            text-align: center;
            color: #DC2626;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input[type="text"],
        .form-group input[type="password"],
        .form-group input[type="email"] {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #DC2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .modal-action-btn {
            width: 100%;
            padding: 12px;
            background: #DC2626;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-action-btn:hover {
            background: #b91c1c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .form-switcher {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #666;
        }

        .form-switcher a {
            color: #DC2626;
            text-decoration: none;
            font-weight: 600;
        }

        .form-switcher a:hover {
            text-decoration: underline;
        }

        /* 會員身分選擇標籤 */
        .member-tabs {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 25px;
            gap: 0;
        }

        .member-tab {
            flex: 1;
            padding: 12px 15px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .member-tab:hover {
            background: #e9ecef;
            color: #333;
        }

        .member-tab.active {
            background: white;
            color: #DC2626;
            border-bottom: 3px solid #DC2626;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .member-notice {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #856404;
            line-height: 1.6;
        }

        .member-notice strong {
            display: block;
            margin-bottom: 5px;
            color: #664d03;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo-title">
            <img src="https://via.placeholder.com/50x50?text=Logo" alt="Logo" class="logo">
            <h1>一如地號搜尋</h1>
        </div>
        <div class="header-nav">
            <a href="index.html" class="back-link">返回主頁</a>
            <a href="#" class="nav-link" id="login-nav-button">登入 / 註冊</a>
            <div id="user-info-display">
                <span id="username-display"></span>
                <button id="logout-button">登出</button>
            </div>
        </div>
    </div>

    <!-- 搜索容器 -->
    <div class="search-container">
        <div class="search-logo">
            <img src="https://via.placeholder.com/200x100?text=一如地產" alt="一如地產">
            <h2>🔍 快速地號搜尋</h2>
            <p>輸入地號即可查詢土地詳細資訊</p>
        </div>
        <div class="search-box">
            <input type="text" id="landNumberInput" class="search-input" placeholder="請輸入地號 (例如: 25, 69, 138)">
            <div class="search-buttons">
                <button class="search-btn" onclick="searchLandNumber()">🔍 開始搜尋</button>
                <button class="clear-btn" onclick="clearSearch()">🔄 清除</button>
            </div>
        </div>
        <div class="search-tips">
            <p><strong>💡 搜尋提示:</strong></p>
            <p>• 可輸入單一或多個地號 (用空格或逗號分隔)</p>
            <p>• 範例: 25 或 25, 69, 138</p>
        </div>
    </div>

    <!-- 搜索结果区域 -->
    <section id="resultsSection" class="results-section">
        <div class="split-container">
            <div class="left-panel">
                <div class="results-header">
                    <div class="results-count">
                        找到 <strong id="resultCount">0</strong> 筆符合的土地
                    </div>
                    <button class="search-btn" onclick="clearSearch()" style="width: 100%;">返回搜尋</button>
                </div>
                <div class="results-list" id="resultsList"></div>
            </div>
            <div class="right-panel">
                <div class="detail-container" id="detailPanel">
                    <div class="empty-state">
                        <h3>請選擇左側的土地</h3>
                        <p>查看詳細資訊</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 登入模態框 -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <button class="close-modal-btn" onclick="closeLoginModal()">&times;</button>
            
            <div id="loginForm">
                <h2>會員登入</h2>
                
                <!-- 登入身分選擇 -->
                <div class="member-tabs">
                    <button class="member-tab active" onclick="switchMemberTab('landlord')">地主/代理人</button>
                    <button class="member-tab" onclick="switchMemberTab('developer')">法人/建商/土開</button>
                    <button class="member-tab" onclick="switchMemberTab('agent')">仲介營業/經紀人</button>
                </div>

                <!-- 地主登入 -->
                <div id="landlord-tab" class="tab-content active">
                    <div class="member-notice">
                        <strong>🏡 地主會員</strong>
                        您可以使用手機號碼或電子郵件登入查看更多土地資訊。
                    </div>
                    <div class="form-group">
                        <label for="landlordAccount">帳號(手機或電子郵件)</label>
                        <input type="text" id="landlordAccount" placeholder="請輸入您的手機號碼或電子郵件">
                    </div>
                    <div class="form-group">
                        <label for="landlordPassword">密碼</label>
                        <input type="password" id="landlordPassword" placeholder="請輸入密碼">
                    </div>
                    <button class="modal-action-btn" onclick="handleMemberLogin('landlord')">登入</button>
                </div>

                <!-- 法人/建商/土開 -->
                <div id="developer-tab" class="tab-content">
                    <div class="member-notice">
                        <strong>⚠️ 企業會員須知</strong>
                        法人會員需提供公司統一編號進行驗證,以確保交易安全與信用。
                    </div>
                    <div class="form-group">
                        <label for="developerAccount">公司統一編號</label>
                        <input type="text" id="developerAccount" placeholder="請輸入8位數統一編號" maxlength="8">
                    </div>
                    <div class="form-group">
                        <label for="developerEmail">電子郵件</label>
                        <input type="email" id="developerEmail" placeholder="請輸入公司電子郵件">
                    </div>
                    <div class="form-group">
                        <label for="developerPassword">密碼</label>
                        <input type="password" id="developerPassword" placeholder="請輸入密碼">
                    </div>
                    <button class="modal-action-btn" onclick="handleMemberLogin('developer')">登入</button>
                </div>

                <!-- 仲介營業/經紀人 -->
                <div id="agent-tab" class="tab-content">
                    <div class="member-notice">
                        <strong>⚠️ 專業人員認證</strong>
                        仲介營業員及不動產經紀人需提供證照字號進行身分驗證。
                    </div>
                    <div class="form-group">
                        <label for="agentLicense">證照字號</label>
                        <input type="text" id="agentLicense" placeholder="請輸入營業員或經紀人證照字號">
                    </div>
                    <div class="form-group">
                        <label for="agentAccount">帳號(手機或電子郵件)</label>
                        <input type="text" id="agentAccount" placeholder="請輸入您的手機號碼或電子郵件">
                    </div>
                    <div class="form-group">
                        <label for="agentPassword">密碼</label>
                        <input type="password" id="agentPassword" placeholder="請輸入密碼">
                    </div>
                    <button class="modal-action-btn" onclick="handleMemberLogin('agent')">登入</button>
                </div>

                <p class="form-switcher">還不是會員? <a href="#" id="showRegisterLink">立即註冊</a></p>
            </div>

            <div id="registerForm" style="display: none;">
                <h2>加入會員</h2>
                
                <!-- 註冊身分選擇 -->
                <div class="member-tabs">
                    <button class="member-tab active" onclick="switchRegisterTab('landlord')">地主/代理人</button>
                    <button class="member-tab" onclick="switchRegisterTab('developer')">法人/建商/土開</button>
                    <button class="member-tab" onclick="switchRegisterTab('agent')">仲介營業/經紀人</button>
                </div>

                <!-- 地主註冊 -->
                <div id="register-landlord-tab" class="tab-content active">
                    <div class="member-notice">
                        <strong>📝 註冊說明</strong>
                        地主會員可免費查詢土地資訊,享有專屬的土地管理功能。
                    </div>
                    <div class="form-group">
                        <label for="regLandlordName">姓名</label>
                        <input type="text" id="regLandlordName" placeholder="請輸入真實姓名">
                    </div>
                    <div class="form-group">
                        <label for="regLandlordAccount">手機或電子郵件</label>
                        <input type="text" id="regLandlordAccount" placeholder="請輸入手機號碼或電子郵件">
                    </div>
                    <div class="form-group">
                        <label for="regLandlordPassword">設定密碼</label>
                        <input type="password" id="regLandlordPassword" placeholder="請設定至少6位數密碼">
                    </div>
                    <button class="modal-action-btn" onclick="handleMemberRegister('landlord')">註冊</button>
                </div>

                <!-- 法人註冊 -->
                <div id="register-developer-tab" class="tab-content">
                    <div class="member-notice">
                        <strong>📝 企業會員註冊</strong>
                        註冊後請準備公司登記證明文件,完成企業認證後即可使用完整功能。
                    </div>
                    <div class="form-group">
                        <label for="regDeveloperCompany">公司名稱</label>
                        <input type="text" id="regDeveloperCompany" placeholder="請輸入公司全名">
                    </div>
                    <div class="form-group">
                        <label for="regDeveloperTaxId">統一編號</label>
                        <input type="text" id="regDeveloperTaxId" placeholder="請輸入8位數統一編號" maxlength="8">
                    </div>
                    <div class="form-group">
                        <label for="regDeveloperEmail">公司電子郵件</label>
                        <input type="email" id="regDeveloperEmail" placeholder="請輸入公司電子郵件">
                    </div>
                    <div class="form-group">
                        <label for="regDeveloperPassword">設定密碼</label>
                        <input type="password" id="regDeveloperPassword" placeholder="請設定至少6位數密碼">
                    </div>
                    <button class="modal-action-btn" onclick="handleMemberRegister('developer')">註冊</button>
                </div>

                <!-- 仲介註冊 -->
                <div id="register-agent-tab" class="tab-content">
                    <div class="member-notice">
                        <strong>📝 專業人員註冊</strong>
                        註冊後請上傳營業員證或經紀人證照,審核通過後即可開始使用專業功能。
                    </div>
                    <div class="form-group">
                        <label for="regAgentName">姓名</label>
                        <input type="text" id="regAgentName" placeholder="請輸入真實姓名">
                    </div>
                    <div class="form-group">
                        <label for="regAgentLicense">證照字號</label>
                        <input type="text" id="regAgentLicense" placeholder="請輸入營業員或經紀人證照字號">
                    </div>
                    <div class="form-group">
                        <label for="regAgentAccount">手機或電子郵件</label>
                        <input type="text" id="regAgentAccount" placeholder="請輸入手機號碼或電子郵件">
                    </div>
                    <div class="form-group">
                        <label for="regAgentPassword">設定密碼</label>
                        <input type="password" id="regAgentPassword" placeholder="請設定至少6位數密碼">
                    </div>
                    <button class="modal-action-btn" onclick="handleMemberRegister('agent')">註冊</button>
                </div>

                <p class="form-switcher">已經是會員? <a href="#" id="showLoginLink">返回登入</a></p>
            </div>
        </div>
    </div>

    <script>
        let currentResults = [];
        let selectedLandId = null;
        let currentUser = null;
        let currentMemberType = 'landlord';
        let currentRegisterType = 'landlord';
        
        const landDatabase = [
            { id: 1, number: '25', title: '信義區精華商業地', district: '信義區', area: 456.3, type: '商業地', totalPrice: 102500, pricePerPing: 224.6, agentType: '專任', delegationStatus: '已委託', lat: 25.0330, lng: 121.5654, ownerPhone: '0912-345-678', ownerContact: '王先生', landPurpose: '商業使用', zoning: '商業區' },
            { id: 2, number: '69', title: '大安區住宅建地', district: '大安區', area: 234.5, type: '建地', totalPrice: 48900, pricePerPing: 208.5, agentType: '一般', delegationStatus: '已委託', lat: 25.0297, lng: 121.5432, ownerPhone: '0923-456-789', ownerContact: '李小姐', landPurpose: '住宅開發', zoning: '住宅區' },
            { id: 3, number: '138', title: '松山區都會建地', district: '松山區', area: 187.2, type: '建地', totalPrice: 37500, pricePerPing: 200.3, agentType: '專任', delegationStatus: '未委託', lat: 25.0504, lng: 121.5778, ownerPhone: '0934-567-890', ownerContact: '張總經理', landPurpose: '商住混合', zoning: '商業區' },
            { id: 4, number: '15', title: '中山區精華地段', district: '中山區', area: 145.8, type: '商業地', totalPrice: null, pricePerPing: null, agentType: '一般', delegationStatus: '未委託', lat: 25.0636, lng: 121.5268, ownerPhone: '0945-678-901', ownerContact: '陳董事長', landPurpose: '商業開發', zoning: '商業區' },
            { id: 5, number: '66', title: '大安區商業黃金地段', district: '大安區', area: 203.4, type: '商業地', totalPrice: 45600, pricePerPing: 224.2, agentType: '專任', delegationStatus: '已委託', lat: 25.0330, lng: 121.5654, ownerPhone: '0956-789-012', ownerContact: '劉經理', landPurpose: '商業大樓', zoning: '商業區' },
            { id: 6, number: '69', title: '大安區住宅建地', district: '大安區', area: 176.9, type: '建地', totalPrice: 38200, pricePerPing: 216.0, agentType: '一般', delegationStatus: '已委託', lat: 25.0297, lng: 121.5432, ownerPhone: '0967-890-123', ownerContact: '林先生', landPurpose: '住宅建設', zoning: '住宅區' },
            { id: 7, number: '25', title: '信義區都會建地', district: '信義區', area: 145.3, type: '建地', totalPrice: null, pricePerPing: null, agentType: '專任', delegationStatus: '未委託', lat: 25.0330, lng: 121.5770, ownerPhone: '0978-901-234', ownerContact: '吳小姐', landPurpose: '商業開發', zoning: '商業區' },
            { id: 8, number: '138', title: '松山區住商混合', district: '松山區', area: 92.7, type: '建地', totalPrice: 16400, pricePerPing: 176.9, agentType: '一般', delegationStatus: '已委託', lat: 25.0504, lng: 121.5778, ownerPhone: '0989-012-345', ownerContact: '黃董', landPurpose: '商住混合', zoning: '商業區' },
            { id: 9, number: '15', title: '中山區精華地段', district: '中山區', area: 68.5, type: '建地', totalPrice: 13200, pricePerPing: 192.7, agentType: '專任', delegationStatus: '已委託', lat: 25.0636, lng: 121.5268, ownerPhone: '0901-123-456', ownerContact: '周先生', landPurpose: '住宅建設', zoning: '住宅區' },
            { id: 10, number: '49', title: '士林區農業用地', district: '士林區', area: 234.6, type: '農地', totalPrice: 18700, pricePerPing: 79.7, agentType: '一般', delegationStatus: '未委託', lat: 25.0938, lng: 121.5252, ownerPhone: '0912-234-567', ownerContact: '鄭先生', landPurpose: '農業使用', zoning: '農業區' },
            { id: 11, number: '68', title: '北投區溫泉區建地', district: '北投區', area: 187.3, type: '建地', totalPrice: 15300, pricePerPing: 81.7, agentType: '專任', delegationStatus: '已委託', lat: 25.1368, lng: 121.5018, ownerPhone: '0923-345-678', ownerContact: '孫小姐', landPurpose: '溫泉飯店', zoning: '特定專用區' },
            { id: 12, number: '12', title: '文山區山坡地建地', district: '文山區', area: 95.8, type: '建地', totalPrice: 9800, pricePerPing: 102.3, agentType: '一般', delegationStatus: '未委託', lat: 24.9890, lng: 121.5710, ownerPhone: '0934-456-789', ownerContact: '何先生', landPurpose: '住宅建設', zoning: '住宅區' },
            { id: 13, number: '16', title: '南港區工業用地', district: '南港區', area: 112.4, type: '工業地', totalPrice: 11500, pricePerPing: 102.3, agentType: '專任', delegationStatus: '已委託', lat: 25.0519, lng: 121.6073, ownerPhone: '0945-567-890', ownerContact: '謝總', landPurpose: '工業廠房', zoning: '工業區' }
        ];

        // 切換登入身分標籤
        function switchMemberTab(type) {
            currentMemberType = type;
            document.querySelectorAll('#loginForm .member-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            document.querySelectorAll('#loginForm .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${type}-tab`).classList.add('active');
        }

        // 切換註冊身分標籤
        function switchRegisterTab(type) {
            currentRegisterType = type;
            document.querySelectorAll('#registerForm .member-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            document.querySelectorAll('#registerForm .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`register-${type}-tab`).classList.add('active');
        }

        // 檢查並更新用戶界面
        function updateHeaderUI() {
            const loginButton = document.getElementById('login-nav-button');
            const userInfoDisplay = document.getElementById('user-info-display');
            const usernameDisplay = document.getElementById('username-display');
            
            const storedUser = sessionStorage.getItem('currentUser');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
            }

            if (currentUser) {
                loginButton.style.display = 'none';
                userInfoDisplay.style.display = 'flex';
                usernameDisplay.textContent = `歡迎, ${currentUser.name} (${currentUser.type})`;
            } else {
                loginButton.style.display = 'block';
                userInfoDisplay.style.display = 'none';
            }
        }

        // 處理會員登入
        function handleMemberLogin(type) {
            let account, password, name, additionalInfo, memberId;
            
            switch(type) {
                case 'landlord':
                    account = document.getElementById('landlordAccount').value.trim();
                    password = document.getElementById('landlordPassword').value.trim();
                    name = account;
                    additionalInfo = '地主/代理人';
                    memberId = 'LD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                    break;
                case 'developer':
                    account = document.getElementById('developerAccount').value.trim();
                    const email = document.getElementById('developerEmail').value.trim();
                    password = document.getElementById('developerPassword').value.trim();
                    name = `統編:${account}`;
                    additionalInfo = '法人/建商';
                    memberId = 'DEV-' + account;
                    
                    if (account.length !== 8 || isNaN(account)) {
                        alert('請輸入正確的8位數統一編號!');
                        return;
                    }
                    if (!email) {
                        alert('請輸入電子郵件!');
                        return;
                    }
                    break;
                case 'agent':
                    const license = document.getElementById('agentLicense').value.trim();
                    account = document.getElementById('agentAccount').value.trim();
                    password = document.getElementById('agentPassword').value.trim();
                    name = account;
                    additionalInfo = '仲介營業/經紀人';
                    memberId = 'AGT-' + license;
                    
                    if (!license) {
                        alert('請輸入證照字號!');
                        return;
                    }
                    break;
            }
            
            if (!account) {
                alert('請輸入帳號!');
                return;
            }
            if (!password) {
                alert('請輸入密碼!');
                return;
            }
            
            currentUser = { 
                memberId: memberId,
                name: name, 
                type: additionalInfo, 
                role: type,
                account: account
            };
            sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            alert(`登入成功!\n會員ID: ${memberId}\n姓名: ${name}\n身分: ${additionalInfo}`);
            closeLoginModal();
            updateHeaderUI();
        }

        // 處理會員註冊
        function handleMemberRegister(type) {
            let name, account, password, additionalInfo;
            
            switch(type) {
                case 'landlord':
                    name = document.getElementById('regLandlordName').value.trim();
                    account = document.getElementById('regLandlordAccount').value.trim();
                    password = document.getElementById('regLandlordPassword').value.trim();
                    additionalInfo = '地主/代理人';
                    
                    if (!name) {
                        alert('請輸入姓名!');
                        return;
                    }
                    break;
                case 'developer':
                    const company = document.getElementById('regDeveloperCompany').value.trim();
                    const taxId = document.getElementById('regDeveloperTaxId').value.trim();
                    account = document.getElementById('regDeveloperEmail').value.trim();
                    password = document.getElementById('regDeveloperPassword').value.trim();
                    name = company;
                    additionalInfo = '法人/建商';
                    
                    if (!company) {
                        alert('請輸入公司名稱!');
                        return;
                    }
                    if (taxId.length !== 8 || isNaN(taxId)) {
                        alert('請輸入正確的8位數統一編號!');
                        return;
                    }
                    break;
                case 'agent':
                    name = document.getElementById('regAgentName').value.trim();
                    const license = document.getElementById('regAgentLicense').value.trim();
                    account = document.getElementById('regAgentAccount').value.trim();
                    password = document.getElementById('regAgentPassword').value.trim();
                    additionalInfo = '仲介營業/經紀人';
                    
                    if (!name) {
                        alert('請輸入姓名!');
                        return;
                    }
                    if (!license) {
                        alert('請輸入證照字號!');
                        return;
                    }
                    break;
            }
            
            if (!account) {
                alert('請輸入帳號!');
                return;
            }
            if (!password || password.length < 6) {
                alert('請設定至少6位數密碼!');
                return;
            }
            
            alert(`註冊成功!\n歡迎加入 ${additionalInfo} 會員!\n\n請使用您的帳號密碼登入。`);
            
            // 切換回登入表單
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        // 處理登出
        function handleLogout() {
            if (confirm('確定要登出嗎?')) {
                currentUser = null;
                sessionStorage.removeItem('currentUser');
                updateHeaderUI();
                alert('已成功登出!');
            }
        }

        function searchLandNumber() {
            const input = document.getElementById('landNumberInput').value.trim();
            if (!input) { 
                alert('請輸入地號'); 
                return; 
            }
            const searchNumbers = input.split(/[\s,，]+/).filter(n => n);
            const results = landDatabase.filter(land => searchNumbers.some(num => land.number === num));
            displayResults(results, searchNumbers);
        }

        function displayResults(results, searchTerms) {
            document.querySelector('.search-container').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('resultCount').textContent = results.length;
            currentResults = results;
            if (results.length === 0) {
                document.getElementById('resultsList').innerHTML = '<div class="no-results"><h3>😕 找不到相關地號</h3><p>搜尋的地號:' + searchTerms.join(', ') + '</p></div>';
                document.getElementById('detailPanel').innerHTML = '<div class="empty-state"><h3>找不到結果</h3><p>請重新搜尋</p></div>';
            } else {
                renderResultsList(results);
                selectLand(results[0].id);
            }
        }

        function renderResultsList(results) {
            const listHTML = results.map(land => {
                const hasPrice = land.totalPrice !== null;
                return '<div class="result-item" onclick="selectLand(' + land.id + ')"><div class="result-item-header"><div class="result-land-number">地號 ' + land.number + '</div><div class="result-badges"><span class="result-badge badge-type">' + land.type + '</span><span class="result-badge badge-agent">' + land.agentType + '</span></div></div><div class="result-item-body"><div class="result-detail"><div class="result-label">區域</div><div class="result-value">' + land.district + '</div></div><div class="result-detail"><div class="result-label">面積</div><div class="result-value">' + land.area + ' 坪</div></div><div class="result-price">' + (hasPrice ? '<div class="result-price-amount">' + formatPrice(land.totalPrice) + ' 萬</div>' : '<div class="no-price-badge">尚無賣家</div>') + '</div></div></div>';
            }).join('');
            document.getElementById('resultsList').innerHTML = listHTML;
        }

        function selectLand(landId) {
            selectedLandId = landId;
            const land = currentResults.find(l => l.id === landId);
            document.querySelectorAll('.result-item').forEach((item, index) => {
                item.classList.toggle('active', currentResults[index].id === landId);
            });
            renderDetailPanel(land);
        }

        function renderDetailPanel(land) {
            const hasPrice = land.totalPrice !== null;
            const detailHTML = '<div class="detail-header"><div class="detail-title">地號 ' + land.number + ' - ' + land.title + '</div><div class="detail-location">📍 台北市 ' + land.district + '</div><div class="detail-badges"><span class="detail-badge" style="background: #DC2626;">' + land.type + '</span><span class="detail-badge" style="background: #2563eb;">' + land.agentType + '</span><span class="detail-badge" style="background: ' + (land.delegationStatus === '已委託' ? '#10b981' : '#f59e0b') + ';">' + land.delegationStatus + '</span></div></div><div class="detail-map" id="detailMap"></div><div class="detail-info-grid"><div class="info-item"><div class="info-label">土地面積</div><div class="info-value">' + land.area + ' 坪</div></div><div class="info-item"><div class="info-label">使用分區</div><div class="info-value">' + land.type + '</div></div><div class="info-item"><div class="info-label">地號</div><div class="info-value">' + land.number + '</div></div></div>' + (hasPrice ? '<div class="detail-price-section"><div class="detail-price-label">總價</div><div class="detail-price-amount">' + formatPrice(land.totalPrice) + '<span class="detail-price-unit">萬</span></div><div class="detail-price-per-ping">每坪 ' + land.pricePerPing.toFixed(1) + ' 萬</div></div>' : '<div class="detail-price-section" style="background: #f59e0b;"><div class="detail-price-amount" style="font-size: 2rem;">尚無賣家</div><div class="detail-price-per-ping">歡迎來電洽詢</div></div>') + '<div class="detail-actions"><button class="action-btn btn-primary" onclick="viewFullDetail()">查看完整資訊</button><button class="action-btn btn-secondary" onclick="memberView()">會員查看</button><button class="action-btn btn-success" onclick="contactUs()">與我聯絡</button></div>';
            document.getElementById('detailPanel').innerHTML = detailHTML;
            setTimeout(() => initDetailMap(land), 100);
        }

        function initDetailMap(land) {
            const mapElement = document.getElementById('detailMap');
            if (!mapElement) return;
            const map = L.map('detailMap').setView([land.lat, land.lng], 16);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            const redIcon = L.icon({ iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iNDIiIHZpZXdCb3g9IjAgMCAzMiA0MiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTYgMEMxMC40NzcgMCA2IDQuNDc3IDYgMTBDNiAxNy41IDE2IDMwIDE2IDMwQzE2IDMwIDI2IDE3LjUgMjYgMTBDMjYgNC40NzcgMjEuNTIzIDAgMTYgMFoiIGZpbGw9IiNEQzI2MjYiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjEwIiByPSI0IiBmaWxsPSJ3aGl0ZSIvPjwvc3ZnPg==', iconSize: [32, 42], iconAnchor: [16, 42] });
            L.marker([land.lat, land.lng], { icon: redIcon }).addTo(map).bindPopup('<b>地號 ' + land.number + '</b><br>' + land.title).openPopup();
        }

        function formatPrice(price) { 
            return price.toLocaleString(); 
        }

        function viewFullDetail() { 
            if (selectedLandId) {
                window.location.href = 'indexyi.html?id=' + selectedLandId; 
            }
        }

        function memberView() {
            if (!currentUser) {
                alert('請先登入會員以查看完整資訊');
                document.getElementById('loginModal').classList.add('show');
                return;
            }

            // 已登入會員跳轉到會員專屬資訊頁面
            if (selectedLandId) {
                window.location.href = 'indexyi2.html?id=' + selectedLandId;
            } else {
                alert('請先選擇一筆土地');
            }
        }

        function contactUs() { 
            alert('感謝您的詢問!我們將盡快與您聯繫'); 
        }

        function clearSearch() {
            document.querySelector('.search-container').style.display = 'flex';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('landNumberInput').value = '';
            document.getElementById('landNumberInput').focus();
            currentResults = [];
            selectedLandId = null;
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('show');
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 设置登入按钮事件
            const loginNavButton = document.getElementById('login-nav-button');
            const loginModal = document.getElementById('loginModal');
            const logoutButton = document.getElementById('logout-button');
            const showRegisterLink = document.getElementById('showRegisterLink');
            const showLoginLink = document.getElementById('showLoginLink');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');

            loginNavButton.addEventListener('click', (e) => {
                e.preventDefault();
                loginModal.classList.add('show');
            });

            logoutButton.addEventListener('click', handleLogout);

            loginModal.addEventListener('click', (e) => {
                if (e.target === loginModal) {
                    closeLoginModal();
                }
            });

            showRegisterLink.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            });

            showLoginLink.addEventListener('click', (e) => {
                e.preventDefault();
                registerForm.style.display = 'none';
                loginForm.style.display = 'block';
            });

            // 更新用戶界面
            updateHeaderUI();

            // 设置Enter键搜索
            document.getElementById('landNumberInput').addEventListener('keypress', function(e) { 
                if (e.key === 'Enter') searchLandNumber(); 
            });
        });
    </script>
</body>
</html>
