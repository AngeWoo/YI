<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€å¦‚åœŸåœ° - æˆ°æƒ…ä¸­å¿ƒ</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
        }

        .war-room-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background-color: #fff;
            padding: 20px 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .header h1 { color: #DC2626; font-size: 2rem; }
        .header-nav a {
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-left: 10px;
        }
        .nav-btn-backend { background-color: #673AB7; }
        .nav-btn-backend:hover { background-color: #512DA8; }
        .nav-btn-home { background-color: #2196F3; }
        .nav-btn-home:hover { background-color: #1976D2; }

        .dashboard-grid {
            padding: 30px 40px;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-auto-rows: minmax(100px, auto);
            gap: 25px;
        }

        .card {
            background-color: #fff;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
        }
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* KPI Cards */
        .kpi-card { grid-column: span 3; }
        .kpi-value { font-size: 2.5rem; font-weight: bold; margin-bottom: 5px; }
        .kpi-change { font-size: 1rem; font-weight: 600; }
        .kpi-change.up { color: #4CAF50; }
        .kpi-change.down { color: #f44336; }

        /* Larger Cards */
        .leaderboard-card { grid-column: span 4; grid-row: span 2; }
        .funnel-card { grid-column: span 8; grid-row: span 2; }
        .region-card { grid-column: span 6; grid-row: span 3; }
        .status-pie-card { grid-column: span 6; grid-row: span 3; }
        .hot-listings-card { grid-column: span 12; }

        /* Leaderboard styles */
        .leaderboard-list { list-style: none; }
        .leaderboard-item { display: flex; align-items: center; margin-bottom: 15px; }
        .leaderboard-rank { font-size: 1.2rem; font-weight: bold; color: #999; width: 40px; }
        .leaderboard-rank.top-1 { color: #FFD700; }
        .leaderboard-rank.top-2 { color: #C0C0C0; }
        .leaderboard-rank.top-3 { color: #CD7F32; }
        .leaderboard-info { flex: 1; }
        .leaderboard-name { font-weight: 600; }
        .leaderboard-dept { font-size: 0.8rem; color: #888; }
        .leaderboard-value { font-size: 1.1rem; font-weight: bold; color: #DC2626; }

        /* Sales Funnel */
        .funnel { display: flex; flex-direction: column; gap: 5px; }
        .funnel-stage {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            clip-path: polygon(0% 0%, 100% 0%, 97% 50%, 100% 100%, 0% 100%);
            transition: transform 0.2s;
        }
        .funnel-stage:hover { transform: scale(1.02); }
        .funnel-stage .label { font-weight: bold; }
        .funnel-stage .value { font-size: 1.1rem; }
        .funnel-stage .conversion { font-size: 0.8rem; opacity: 0.8; }
        
        /* Region Performance - Bar Chart */
        .bar-chart-container { list-style: none; }
        .bar-chart-item { margin-bottom: 15px; }
        .bar-chart-label { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; }
        .bar-chart-bar-bg { background-color: #e0e0e0; border-radius: 5px; height: 10px; }
        .bar-chart-bar { background: linear-gradient(90deg, #F59E0B, #D97706); height: 100%; border-radius: 5px; }
        
        /* Status Pie Chart */
        .pie-chart-container { display: flex; align-items: center; gap: 20px; }
        .pie-chart {
            width: 200px; height: 200px;
            border-radius: 50%;
            background: conic-gradient(#4CAF50 0% 50%, #FF9800 50% 80%, #2196F3 80% 95%, #9C27B0 95% 100%);
        }
        .pie-legend { list-style: none; }
        .pie-legend-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .legend-color { width: 15px; height: 15px; border-radius: 3px; }
        
        /* Hot Listings Table */
        .hot-table { width: 100%; border-collapse: collapse; }
        .hot-table th, .hot-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .hot-table th { font-size: 0.9rem; color: #888; }

        @media (max-width: 1200px) {
            .kpi-card { grid-column: span 6; }
            .leaderboard-card { grid-column: span 12; grid-row: span 1; }
            .funnel-card { grid-column: span 12; grid-row: span 1; }
        }
        @media (max-width: 768px) {
            .header { padding: 15px 20px; flex-direction: column; align-items: flex-start; gap: 10px; }
            .dashboard-grid { padding: 20px; grid-template-columns: 1fr; }
            .card { grid-column: span 1 !important; }
            .kpi-value { font-size: 2rem; }
            .pie-chart-container { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="war-room-container">
        <header class="header">
            <h1>ğŸ¯ ä¸€å¦‚åœŸåœ° - æˆ°æƒ…ä¸­å¿ƒ (War Room)</h1>
            <nav class="header-nav">
                <a href="indexbackend.html" class="nav-btn-backend">ğŸ“Š è¿”å›å¾Œå°</a>
                <a href="index.html" class="nav-btn-home">ğŸ  è¿”å›é¦–é </a>
            </nav>
        </header>

        <main class="dashboard-grid">
            <!-- KPIs -->
            <div class="card kpi-card">
                <div class="card-title">ğŸ“ˆ ç¸½æ¡ˆä»¶åƒ¹å€¼ (æ½›åœ¨)</div>
                <div class="kpi-value" id="kpi-total-value">0å„„</div>
                <div class="kpi-change up" id="kpi-total-value-change">+5.2% æœ¬æœˆ</div>
            </div>
            <div class="card kpi-card">
                <div class="card-title">âœ… æœ¬æœˆæˆäº¤é‡‘é¡</div>
                <div class="kpi-value" id="kpi-closed-value">0è¬</div>
                <div class="kpi-change up" id="kpi-closed-value-change">+120% ä¸Šæœˆ</div>
            </div>
            <div class="card kpi-card">
                <div class="card-title">â³ å¹³å‡æˆäº¤é€±æœŸ</div>
                <div class="kpi-value" id="kpi-cycle-time">0å¤©</div>
                <div class="kpi-change down" id="kpi-cycle-time-change">-3 å¤©</div>
            </div>
            <div class="card kpi-card">
                <div class="card-title">ğŸ‘¥ ä»Šæ—¥æ´»èºç”¨æˆ¶</div>
                <div class="kpi-value" id="kpi-active-users">0</div>
                <div class="kpi-change up" id="kpi-active-users-change">å³æ™‚æ›´æ–°ä¸­...</div>
            </div>

            <!-- Sales Funnel -->
            <div class="card funnel-card">
                <div class="card-title">ğŸ’§ æ¥­å‹™é–‹ç™¼æ¼æ–— (æœ¬å­£)</div>
                <div class="funnel" id="sales-funnel">
                    <!-- Funnel stages will be generated by JS -->
                </div>
            </div>

            <!-- Sales Leaderboard -->
            <div class="card leaderboard-card">
                <div class="card-title">ğŸ† æ¥­å‹™è‹±é›„æ¦œ (æœ¬æœˆæˆäº¤é¡)</div>
                <ul class="leaderboard-list" id="leaderboard">
                    <!-- Leaderboard items will be generated by JS -->
                </ul>
            </div>
            
            <!-- Region Performance -->
            <div class="card region-card">
                <div class="card-title">ğŸŒ åœ°å€ç†±åº¦æ’è¡Œ (æ¡ˆä»¶æ•¸é‡)</div>
                <ul class="bar-chart-container" id="region-performance">
                    <!-- Region bars will be generated by JS -->
                </ul>
            </div>

            <!-- Case Status -->
            <div class="card status-pie-card">
                <div class="card-title">ğŸ“Š ç·šä¸Šå¹³å°æ¡ˆä»¶ç‹€æ…‹</div>
                <div class="pie-chart-container">
                    <div class="pie-chart" id="status-pie-chart"></div>
                    <ul class="pie-legend" id="pie-legend">
                        <!-- Legend items will be generated by JS -->
                    </ul>
                </div>
            </div>

            <!-- Hot Listings -->
            <div class="card hot-listings-card">
                <div class="card-title">ğŸ”¥ ç†±é–€ç«¶åƒ¹æ¡ˆä»¶ (è¿‘24å°æ™‚)</div>
                <table class="hot-table">
                    <thead><tr><th>æ¨™é¡Œ</th><th>åœ°å€</th><th>ç›®å‰æœ€é«˜å‡ºåƒ¹</th><th>å‡ºåƒ¹æ¬¡æ•¸</th><th>ç‹€æ…‹</th></tr></thead>
                    <tbody id="hot-listings-table">
                        <!-- Table rows will be generated by JS -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            function generateAndRenderData() {
                // --- Mock Data Generation ---
                const regions = ["å°åŒ—å¸‚", "æ–°åŒ—å¸‚", "æ¡ƒåœ’å¸‚", "å°ä¸­å¸‚", "å°å—å¸‚", "é«˜é›„å¸‚"];
                const salesAgents = [
                    { name: 'ç‹å°æ˜', department: 'åŒ—å€æ¥­å‹™éƒ¨', deals: Math.floor(Math.random() * 20), value: Math.floor(Math.random() * 50000) },
                    { name: 'æç¾è¯', department: 'åŒ—å€æ¥­å‹™éƒ¨', deals: Math.floor(Math.random() * 20), value: Math.floor(Math.random() * 50000) },
                    { name: 'é™³å»ºåœ‹', department: 'ä¸­å€æ¥­å‹™éƒ¨', deals: Math.floor(Math.random() * 20), value: Math.floor(Math.random() * 50000) },
                    { name: 'æ—æ·‘èŠ¬', department: 'ä¸­å€æ¥­å‹™éƒ¨', deals: Math.floor(Math.random() * 20), value: Math.floor(Math.random() * 50000) },
                    { name: 'å¼µå¿—å‰›', department: 'å—å€æ¥­å‹™éƒ¨', deals: Math.floor(Math.random() * 20), value: Math.floor(Math.random() * 50000) },
                    { name: 'é»ƒé›…ç´', department: 'å—å€æ¥­å‹™éƒ¨', deals: Math.floor(Math.random() * 20), value: Math.floor(Math.random() * 50000) }
                ];
                const funnelData = [
                    { stage: 'æ–°æ¡ˆä»¶', value: 125, amount: 25.6 },
                    { stage: 'åˆæ­¥æ¥è§¸', value: 98, amount: 21.1 },
                    { stage: 'å¯¦åœ°å‹˜æŸ¥', value: 65, amount: 18.2 },
                    { stage: 'è­°åƒ¹ä¸­', value: 31, amount: 12.5 },
                    { stage: 'å·²æˆäº¤', value: 15, amount: 8.9 }
                ];
                const platformStatus = { bidding: 28, negotiating: 6, sold: 18, overpriced: 12 };
                const hotListingsData = [
                    { title: 'ä¿¡ç¾©å€å•†æ¥­ç”¨åœ°A', region: 'å°åŒ—å¸‚', highestBid: 125000, bidCount: 58, status: 'ç«¶åƒ¹ä¸­' },
                    { title: 'è¥¿å±¯å€é‡åŠƒå€B', region: 'å°ä¸­å¸‚', highestBid: 88000, bidCount: 45, status: 'ç«¶åƒ¹ä¸­' },
                    { title: 'å·¦ç‡Ÿå€ä½å®…å»ºåœ°C', region: 'é«˜é›„å¸‚', highestBid: 56000, bidCount: 32, status: 'ä¸€å¦‚å”å•†' }
                ];

                const formatPrice = (price) => price >= 10000 ? `${(price / 10000).toFixed(1)}å„„` : `${price.toLocaleString()}è¬`;
                
                // --- Render KPIs ---
                document.getElementById('kpi-total-value').textContent = `${(Math.random() * 50 + 100).toFixed(1)}å„„`;
                document.getElementById('kpi-closed-value').textContent = `${formatPrice(salesAgents.reduce((sum, a) => sum + a.value, 0))}`;
                document.getElementById('kpi-cycle-time').textContent = `${Math.floor(Math.random() * 20 + 45)}å¤©`;
                document.getElementById('kpi-active-users').textContent = Math.floor(Math.random() * 200 + 150);
                
                // --- Render Sales Funnel ---
                const funnelContainer = document.getElementById('sales-funnel');
                funnelContainer.innerHTML = '';
                for (let i = 0; i < funnelData.length; i++) {
                    const item = funnelData[i];
                    let conversionRate = '';
                    if (i > 0) {
                        const rate = ((item.value / funnelData[i-1].value) * 100).toFixed(1);
                        conversionRate = `<span class="conversion">è½‰æ›ç‡: ${rate}%</span>`;
                    }
                    funnelContainer.innerHTML += `
                        <div class="funnel-stage" style="width: ${100 - i*8}%;">
                            <span class="label">${item.stage}</span>
                            <div style="text-align: right;">
                                <span class="value">${item.value} ä»¶ / ${item.amount} å„„</span>
                                ${conversionRate}
                            </div>
                        </div>`;
                }

                // --- Render Leaderboard ---
                const leaderboardContainer = document.getElementById('leaderboard');
                leaderboardContainer.innerHTML = '';
                salesAgents.sort((a, b) => b.value - a.value).forEach((agent, i) => {
                    const rankClass = i < 3 ? `top-${i+1}` : '';
                    leaderboardContainer.innerHTML += `
                        <li class="leaderboard-item">
                            <div class="leaderboard-rank ${rankClass}">#${i+1}</div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">${agent.name}</div>
                                <div class="leaderboard-dept">${agent.department}</div>
                            </div>
                            <div class="leaderboard-value">${formatPrice(agent.value)}</div>
                        </li>`;
                });

                // --- Render Region Performance ---
                const regionContainer = document.getElementById('region-performance');
                regionContainer.innerHTML = '';
                const regionData = regions.map(r => ({ region: r, count: Math.floor(Math.random() * 100) })).sort((a,b) => b.count - a.count);
                const maxCount = regionData[0].count;
                regionData.forEach(item => {
                    regionContainer.innerHTML += `
                        <li class="bar-chart-item">
                            <div class="bar-chart-label"><span>${item.region}</span><span>${item.count}ä»¶</span></div>
                            <div class="bar-chart-bar-bg">
                                <div class="bar-chart-bar" style="width: ${(item.count / maxCount) * 100}%;"></div>
                            </div>
                        </li>`;
                });

                // --- Render Status Pie Chart ---
                const pieChart = document.getElementById('status-pie-chart');
                const pieLegend = document.getElementById('pie-legend');
                pieLegend.innerHTML = '';
                const totalStatus = Object.values(platformStatus).reduce((sum, val) => sum + val, 0);
                const statusColors = { bidding: '#4CAF50', negotiating: '#FF9800', sold: '#2196F3', overpriced: '#9C27B0' };
                let gradientString = '';
                let currentPercentage = 0;
                Object.entries(platformStatus).forEach(([status, value]) => {
                    const percentage = (value / totalStatus) * 100;
                    gradientString += `${statusColors[status]} ${currentPercentage}% ${currentPercentage + percentage}%, `;
                    currentPercentage += percentage;
                    
                    pieLegend.innerHTML += `
                        <li class="pie-legend-item">
                            <div class="legend-color" style="background-color: ${statusColors[status]};"></div>
                            <span>${status.charAt(0).toUpperCase() + status.slice(1)} (${value}ä»¶, ${percentage.toFixed(1)}%)</span>
                        </li>`;
                });
                pieChart.style.background = `conic-gradient(${gradientString.slice(0, -2)})`;

                // --- Render Hot Listings Table ---
                const hotTableBody = document.getElementById('hot-listings-table');
                hotTableBody.innerHTML = '';
                hotListingsData.forEach(item => {
                    hotTableBody.innerHTML += `
                        <tr>
                            <td>${item.title}</td>
                            <td>${item.region}</td>
                            <td>${formatPrice(item.highestBid)}</td>
                            <td>${item.bidCount}</td>
                            <td><span style="color: ${item.status === 'ç«¶åƒ¹ä¸­' ? '#DC2626' : '#673AB7'}; font-weight: 600;">${item.status}</span></td>
                        </tr>`;
                });
            }

            // Initial render
            generateAndRenderData();

            // Simulate real-time update for active users
            setInterval(() => {
                const userCount = parseInt(document.getElementById('kpi-active-users').textContent);
                const change = Math.floor(Math.random() * 10 - 5);
                document.getElementById('kpi-active-users').textContent = Math.max(50, userCount + change);
            }, 3000);
        });
    </script>
</body>
</html>